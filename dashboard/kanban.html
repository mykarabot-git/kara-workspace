<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban | KARA Command</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#0a0a0c',
                        card: 'rgba(255, 255, 255, 0.03)',
                        border: 'rgba(255, 255, 255, 0.08)',
                        accent: '#7c3aed',
                        cyan: '#22d3ee'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0a0a0c; color: white; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .col-header { border-bottom: 2px solid rgba(255,255,255,0.05); }
        .task-card { transition: transform 0.2s, border-color 0.2s; cursor: grab; }
        .task-card:hover { transform: translateY(-2px); border-color: rgba(255,255,255,0.2); }
        .task-card:active { cursor: grabbing; }
    </style>
</head>
<body class="p-8 min-h-screen flex flex-col">
    
    <!-- Header -->
    <header class="flex justify-between items-center mb-8">
        <div class="flex items-center gap-4">
            <a href="index.html" class="p-2 rounded-full glass hover:bg-white/5 transition-colors">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
            </a>
            <h1 class="text-2xl font-bold tracking-tight">Mission Control</h1>
        </div>
    <!-- Modal -->
    <div id="taskModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="glass p-6 rounded-2xl w-full max-w-md border border-accent/20 relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-500 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
            
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                <i data-lucide="layers" class="text-accent"></i> 
                <span id="modalTitle">New Mission</span>
            </h2>
            
            <input type="hidden" id="taskId"> <!-- Store ID for editing -->

            <div class="space-y-4">
                <div>
                    <label class="block text-xs text-gray-400 mb-1 uppercase tracking-wider">Task Name</label>
                    <input type="text" id="taskTitleInput" class="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-sm focus:border-accent focus:outline-none text-white" placeholder="e.g. Deploy Nexus MVP">
                </div>

                <div>
                    <label class="block text-xs text-gray-400 mb-1 uppercase tracking-wider">Project / Tag</label>
                    <div class="flex gap-2">
                        <input list="tagOptions" id="taskTagInput" class="flex-1 bg-white/5 border border-white/10 rounded-lg p-3 text-sm focus:border-accent focus:outline-none text-white" placeholder="Select or type...">
                        <datalist id="tagOptions">
                            <option value="NEXUS">
                            <option value="CONTENT">
                            <option value="SYSTEM">
                            <option value="ARCH">
                            <option value="RESEARCH">
                            <option value="SELF_IMPROVE">
                            <option value="OPS">
                        </datalist>
                    </div>
                </div>

                <div>
                    <label class="block text-xs text-gray-400 mb-1 uppercase tracking-wider">Notes / Details</label>
                    <textarea id="taskNotesInput" rows="3" class="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-sm focus:border-accent focus:outline-none text-gray-300" placeholder="Add context, links, or subtasks..."></textarea>
                </div>

                <div>
                    <label class="block text-xs text-gray-400 mb-2 uppercase tracking-wider">Assignee</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="cursor-pointer">
                            <input type="radio" name="assignee" value="KARA" class="peer sr-only">
                            <div class="p-3 rounded-lg border border-white/10 bg-white/5 peer-checked:border-purple-500 peer-checked:bg-purple-500/10 flex items-center gap-2 transition-all hover:bg-white/10">
                                <div class="w-2 h-2 rounded-full bg-purple-400 shadow-[0_0_10px_rgba(192,132,252,0.8)]"></div>
                                <span class="text-sm font-bold text-gray-200 peer-checked:text-purple-300">KARA</span>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="assignee" value="Melody" class="peer sr-only">
                            <div class="p-3 rounded-lg border border-white/10 bg-white/5 peer-checked:border-cyan-500 peer-checked:bg-cyan-500/10 flex items-center gap-2 transition-all hover:bg-white/10">
                                <div class="w-2 h-2 rounded-full bg-cyan-400 shadow-[0_0_10px_rgba(34,211,238,0.8)]"></div>
                                <span class="text-sm font-bold text-gray-200 peer-checked:text-cyan-300">Melody</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="flex gap-3 pt-2">
                    <button onclick="deleteTask()" id="deleteBtn" class="px-4 py-3 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg font-bold transition-opacity hidden">
                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                    </button>
                    <button onclick="saveTask()" class="flex-1 py-3 bg-gradient-to-r from-accent to-cyan rounded-lg font-bold text-white hover:opacity-90 transition-opacity">
                        Save Mission
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Board -->
    <div class="flex gap-6 overflow-x-auto pb-4 h-full flex-1">
        
        <!-- To Do -->
        <div class="min-w-[320px] glass rounded-2xl flex flex-col">
            <div class="p-4 col-header flex justify-between items-center">
                <h3 class="font-bold text-gray-400 uppercase text-xs tracking-wider">To Do</h3>
                <span id="count-todo" class="bg-white/5 text-gray-500 text-xs px-2 py-1 rounded">0</span>
            </div>
            <div class="p-4 space-y-3 flex-1 overflow-y-auto" id="col-todo" ondrop="drop(event)" ondragover="allowDrop(event)">
                <!-- Tasks injected here -->
            </div>
        </div>

        <!-- In Progress -->
        <div class="min-w-[320px] glass rounded-2xl flex flex-col bg-accent/5 border-accent/20">
            <div class="p-4 col-header flex justify-between items-center border-accent/10">
                <h3 class="font-bold text-accent uppercase text-xs tracking-wider">In Progress</h3>
                <span id="count-inprogress" class="bg-accent/10 text-accent text-xs px-2 py-1 rounded">0</span>
            </div>
            <div class="p-4 space-y-3 flex-1 overflow-y-auto" id="col-inprogress" ondrop="drop(event)" ondragover="allowDrop(event)">
            </div>
        </div>

        <!-- Done -->
        <div class="min-w-[320px] glass rounded-2xl flex flex-col">
            <div class="p-4 col-header flex justify-between items-center">
                <h3 class="font-bold text-gray-400 uppercase text-xs tracking-wider">Done</h3>
                <span id="count-done" class="bg-white/5 text-gray-500 text-xs px-2 py-1 rounded">0</span>
            </div>
            <div class="p-4 space-y-3 flex-1 overflow-y-auto opacity-60" id="col-done" ondrop="drop(event)" ondragover="allowDrop(event)">
            </div>
        </div>

    </div>

    <script>
        // --- Data & State ---
        let tasks = [
            { id: 't1', title: 'Initialize Next.js Monorepo', tag: 'NEXUS', assignee: 'KARA', status: 'todo', notes: 'Set up Turborepo with apps/web and packages/ui.' },
            { id: 't2', title: 'Populate Tech Tips Blog', tag: 'CONTENT', assignee: 'Melody', status: 'todo', notes: 'Review generated drafts and publish.' },
            { id: 't3', title: 'Research OpenClaw Capabilities', tag: 'SELF_IMPROVE', assignee: 'KARA', status: 'inprogress', notes: 'Deep dive into docs for advanced automation patterns.' },
            { id: 't4', title: 'NEXUS Spec: Audio Engine', tag: 'ARCH', assignee: 'KARA', status: 'inprogress', notes: 'Drafting waveform rendering logic.' },
            { id: 't5', title: 'Deploy Tech Tips MVP', tag: 'WEB', assignee: 'KARA', status: 'done', notes: 'Live at /projects/tech-tips/' }
        ];

        // --- Init ---
        function renderBoard() {
            // Clear cols
            ['todo', 'inprogress', 'done'].forEach(s => {
                document.getElementById('col-' + s).innerHTML = '';
                let count = tasks.filter(t => t.status === s).length;
                document.getElementById('count-' + s).innerText = count;
            });

            tasks.forEach(task => {
                const col = document.getElementById('col-' + task.status);
                if (!col) return;

                const el = document.createElement('div');
                el.className = `task-card glass p-4 rounded-xl border border-transparent ${task.status === 'done' ? 'opacity-75' : ''}`;
                el.draggable = true;
                el.ondragstart = (e) => drag(e, task.id);
                el.onclick = () => openEditModal(task.id);
                
                // Styles
                const isKara = task.assignee === 'KARA';
                const dotColor = isKara ? 'bg-purple-400' : 'bg-cyan-400';
                const pulse = isKara && task.status !== 'done' ? 'animate-pulse' : '';
                const tagColor = getTagColor(task.tag);

                el.innerHTML = `
                    <div class="flex justify-between items-start mb-2 pointer-events-none">
                        <span class="text-[10px] font-mono font-bold ${tagColor} px-2 py-0.5 rounded tracking-wide">${task.tag}</span>
                        <div class="flex items-center gap-1 bg-white/5 px-2 py-1 rounded-full border border-white/5">
                            <div class="w-1.5 h-1.5 rounded-full ${dotColor} ${pulse}"></div>
                            <span class="text-[10px] uppercase font-bold text-gray-400">${task.assignee}</span>
                        </div>
                    </div>
                    <p class="font-medium text-sm mb-3 text-gray-200 leading-snug pointer-events-none">${task.title}</p>
                    <div class="flex items-center justify-between text-xs text-gray-600 pointer-events-none">
                        <div class="flex items-center gap-1">
                            ${task.notes ? '<i data-lucide="file-text" class="w-3 h-3 text-gray-500"></i>' : ''}
                        </div>
                        <i data-lucide="more-horizontal" class="w-4 h-4 hover:text-white transition-colors"></i>
                    </div>
                `;
                col.appendChild(el);
            });
            lucide.createIcons();
        }

        function getTagColor(tag) {
            const map = {
                'NEXUS': 'text-cyan-400 bg-cyan-400/10',
                'CONTENT': 'text-pink-400 bg-pink-400/10',
                'SYSTEM': 'text-gray-400 bg-gray-400/10',
                'ARCH': 'text-yellow-400 bg-yellow-400/10',
                'SELF_IMPROVE': 'text-purple-400 bg-purple-400/10',
                'OPS': 'text-green-400 bg-green-400/10'
            };
            return map[tag] || 'text-blue-400 bg-blue-400/10';
        }

        // --- Modal Actions ---
        function openModal() {
            // Reset for new task
            document.getElementById('taskId').value = '';
            document.getElementById('modalTitle').innerText = 'New Mission';
            document.getElementById('taskTitleInput').value = '';
            document.getElementById('taskTagInput').value = '';
            document.getElementById('taskNotesInput').value = '';
            document.querySelector('input[name="assignee"][value="KARA"]').checked = true;
            document.getElementById('deleteBtn').classList.add('hidden');
            
            document.getElementById('taskModal').classList.remove('hidden');
            document.getElementById('taskTitleInput').focus();
        }

        function openEditModal(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;

            document.getElementById('taskId').value = task.id;
            document.getElementById('modalTitle').innerText = 'Edit Mission';
            document.getElementById('taskTitleInput').value = task.title;
            document.getElementById('taskTagInput').value = task.tag;
            document.getElementById('taskNotesInput').value = task.notes || '';
            
            // Radio select
            const radio = document.querySelector(`input[name="assignee"][value="${task.assignee}"]`);
            if (radio) radio.checked = true;

            document.getElementById('deleteBtn').classList.remove('hidden');
            document.getElementById('taskModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('taskModal').classList.add('hidden');
        }

        function saveTask() {
            const id = document.getElementById('taskId').value;
            const title = document.getElementById('taskTitleInput').value;
            const tag = document.getElementById('taskTagInput').value || 'GENERIC';
            const notes = document.getElementById('taskNotesInput').value;
            const assignee = document.querySelector('input[name="assignee"]:checked').value;

            if (!title) return;

            if (id) {
                // Update existing
                const task = tasks.find(t => t.id === id);
                if (task) {
                    task.title = title;
                    task.tag = tag;
                    task.notes = notes;
                    task.assignee = assignee;
                }
            } else {
                // Create new
                const newTask = {
                    id: 't' + Date.now(),
                    title: title,
                    tag: tag,
                    notes: notes,
                    assignee: assignee,
                    status: 'todo' // Default column
                };
                tasks.unshift(newTask);
            }

            renderBoard();
            closeModal();
        }

        function deleteTask() {
            const id = document.getElementById('taskId').value;
            if (id) {
                tasks = tasks.filter(t => t.id !== id);
                renderBoard();
                closeModal();
            }
        }

        // --- Drag & Drop (Simple) ---
        function allowDrop(ev) { ev.preventDefault(); }
        function drag(ev, id) { ev.dataTransfer.setData("text", id); }
        function drop(ev) {
            ev.preventDefault();
            const id = ev.dataTransfer.getData("text");
            // Find closest column ID
            const col = ev.target.closest('[id^="col-"]');
            if (col && id) {
                const status = col.id.replace('col-', '');
                const task = tasks.find(t => t.id === id);
                if (task) {
                    task.status = status;
                    renderBoard();
                }
            }
        }

        // Boot
        renderBoard();
    </script>
</body>
</html>